<h1 mat-dialog-title>{{ data.name }} の詳細</h1>
<div mat-dialog-content>

  <h2 class="section-title">基本情報</h2>
  <div class="info-grid">
    <mat-form-field appearance="fill">
      <mat-label>名前</mat-label>
      <input matInput [(ngModel)]="data.name" [readonly]="!initialData.isAdmin">
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>所要時間(分)</mat-label>
      <input matInput type="number" [(ngModel)]="data.time" [readonly]="!initialData.isAdmin">
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>最小人数</mat-label>
      <input matInput type="number" [(ngModel)]="data.min" [readonly]="!initialData.isAdmin">
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>最大人数</mat-label>
      <input matInput type="number" [(ngModel)]="data.max" [readonly]="!initialData.isAdmin">
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>所有者</mat-label>
      <input matInput [(ngModel)]="data.ownerName" [readonly]="!initialData.isAdmin">
    </mat-form-field>
  </div>

  <mat-divider></mat-divider>

  <h2 class="section-title">タグ</h2>
  <mat-form-field appearance="fill" class="tag-chip-list">
    <mat-label>タグを追加・削除</mat-label>
    <mat-chip-grid #chipGrid>
      <mat-chip-row *ngFor="let tag of data.tags" (removed)="removeTag(tag)">
        {{tag}}
        <button matChipRemove>
          <mat-icon>cancel</mat-icon>
        </button>
      </mat-chip-row>
    </mat-chip-grid>
    <input matInput placeholder="新しいタグ..." [matChipInputFor]="chipGrid" [matChipInputAddOnBlur]="true" (matChipInputTokenEnd)="addTag($event)" />
  </mat-form-field>

  <mat-divider></mat-divider>

  <h2 class="section-title">あなたの評価</h2>
  <div class="evaluation-container">
    <mat-checkbox [(ngModel)]="data.played">プレイ済み</mat-checkbox>
    <div class="evaluation-section">
      <div class="stars">
        <mat-icon *ngFor="let star of maxStarsArray; let i = index"
                  (click)="setRating(i + 1)"
                  [ngClass]="{'filled-star': getStarIcon(data.evaluation, i) !== 'star_border'}">
          {{ getStarIcon(data.evaluation, i) }}
        </mat-icon>
      </div>
    </div>
  </div>
  <div class="evaluation-guide">
    <p><strong>評価の決め方:</strong></p>
    <ul>
      <li><strong>☆☆☆☆☆:</strong> 殿堂入り</li>
      <li><strong>☆☆☆☆:</strong> 何度だってプレイしたい</li>
      <li><strong>☆☆☆:</strong> 2回目をやりたくなる</li>
      <li><strong>☆☆:</strong> 誘われたらやる</li>
      <li><strong>☆:</strong> やる気になれない</li>
    </ul>
  </div>

  <mat-divider></mat-divider>

  <h2 class="section-title">みんなの評価</h2>
  <div class="all-evaluations-section">
    <table mat-table [dataSource]="allEvaluationsDataSource" class="mat-elevation-z8">
      <ng-container matColumnDef="photo">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element">
          <img [src]="element.userPhotoUrl" alt="User Photo" class="user-photo">
        </td>
      </ng-container>
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> ユーザー名 </th>
        <td mat-cell *matCellDef="let element"> {{element.userName}} </td>
      </ng-container>
      <ng-container matColumnDef="evaluation">
        <th mat-header-cell *matHeaderCellDef> 評価 </th>
        <td mat-cell *matCellDef="let element">
          <mat-icon *ngFor="let star of maxStarsArray; let i = index"
                    [ngClass]="{'filled-star': getStarIcon(element.evaluation, i) !== 'star_border'}">
            {{ getStarIcon(element.evaluation, i) }}
          </mat-icon>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedEvaluationColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedEvaluationColumns;"></tr>
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="{{displayedEvaluationColumns.length}}">このボードゲームの評価はまだありません。</td>
      </tr>
    </table>
  </div>
</div>
<div mat-dialog-actions>
  <button mat-button (click)="onNoClick()">キャンセル</button>
  <button mat-button [mat-dialog-close]="data" cdkFocusInitial>保存</button>
</div>
